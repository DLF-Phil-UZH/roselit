<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * @author Thomas Bernhart, thomascbernhart@gmail.com
 */
class User_mapper extends CI_Model {

    /**
     * Name of the db table
     * @type string
     */
	private $tableName = "users";

	public function save(User_model $pUser){
		$lData = array(
					"aaiId" => $pUser->getAaiId(),
					"username" => $pUser->getUsername(),
					"firstname" => $pUser->getFirstname(),
					"lastname" => $pUser->getLastname(),
					"role" => $pUser->getRole()
				);
		if($pUser->isNew()){
			$lData["created"] = NULL;
			$this->db->insert($this->tableName, $lData);
			$pUser->setId($this->db->insert_id()); // Add id generated by database to the doc list object
		}
		else{
			$this->db->where("id", $pUser->getId());
			$this->db->update($this->tableName, $lData);
		}
	}		

	public function delete(User_model $pUser){
		if (!$User->isNew()) {
			$this->db->where('id', $pUser->getId());
			$this->db->delete($this->tableName);
		}
	}
	
	public function get($pId){
		$lQuery = $this->db->get_where($this->tableName, array('id' => $pId), 1);
		if ($lQuery->num_rows() == 1) {
			$lResult = $lQuery->row();
			$lUser = $this->_createUser($row);
			return $lUser;
		}
		return false;
	}
	
	/**
	 *
	 */
	public function getByAaiId($pAaiId) {
    	$lQuery = $this->db-get_where($this->tableName, array('aaiId' => $pAaiId), 1);
		if ($lQuery->num_rows() == 1) {
			$lResult = $lQuery->row();
			$lUser = $this->_createUser($row);
			return $lUser;
		}
		return false;
	}

	/**
	 * TODO
	 */
	/*
	private function _get($pParams = array(), $pLimit) {
    	if (is_array($pParams)) {
			$this->db->where($pParams);
		} else {
			$this->db->where('id', $pId);
			$this->db->where->limit(1);
		}
		if ($lquery->num_rows() == 1) {
			
		}

	}
	*/

	/**
 	 *
 	 */
	private function _createUser($pRow = array()) {
    	$lUser = new User_model(
						$row->username,
						$row->aaiId,
						$row->firstname,
						$row->lastname,
						'' /* title */,
						$row->gender
					);
		$lUser->setId($row->id);
		return $lUser;
	}
}


/* End of file user_mapper.php */
/* Location: ./application/library/user_mapper.php */

